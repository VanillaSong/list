<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="robots" content="noindex, nofollow">
	<meta http-equiv="Cache-Control" content="max-age=31536000, immutable">
    <title>Vanilla Songlist</title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
	<link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" as="script">
	<script defer src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
	<link rel="icon" type="image/x-icon" href="icons/favicon.png">
	<style>
		:root {
			--bg-color: #2d2d2d;
			--header-bg: #333;
			--text-color: #fff;
			--button-bg: #444;
			--button-hover: #555;
			--border-color: #444;
			--row-alt-bg: #333;
			--pagination-bg: #333;
			--pagination-border: #444;
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
			font-family: 'Open Sans', sans-serif;
		}

		body {
			background-color: var(--bg-color);
			color: var(--text-color);
			padding: 20px;
			position: relative;
			min-height: 100vh;
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
		}

		.header {
			display: flex;
			align-items: center;
			background-color: var(--header-bg);
			padding: 10px 15px;
			border-radius: 5px 5px 0 0;
			gap: 10px;
			position: sticky;
			top: 0;
			z-index: 100;
			flex-wrap: wrap;
		}

		.search-container {
			display: flex;
			align-items: center;
			background-color: #444;
			border-radius: 5px;
			padding: 5px 10px;
			flex: 1;
			min-width: 200px;
			position: relative;
		}

		.search-icon {
			margin-right: 5px;
			color: #999;
		}

		.search-input {
			flex-grow: 1;
			background: transparent;
			border: none;
			color: var(--text-color);
			outline: none;
			padding: 5px 0;
		}

		.search-clear {
			background: transparent;
			border: none;
			color: #999;
			cursor: pointer;
			padding: 0 5px;
		}

		.icon-buttons {
			display: flex;
			gap: 5px;
			flex-wrap: wrap;
		}

		.icon-button {
			width: 38px;
			height: 38px;
			background-color: var(--button-bg);
			border-radius: 5px;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: background-color 0.2s;
			flex-shrink: 0;
		}

		.icon-button:hover {
			background-color: var(--button-hover);
		}

		.icon-button img {
			width: 25px;
			height: 25px;
			object-fit: contain;
		}

		/* === –®–∞–ø–∫–∞ —Ç–∞–±–ª–∏—Ü—ã === */
		.table-header-row {
			display: grid;
			grid-template-columns: minmax(200px, 1fr) minmax(200px, 1fr) 120px 120px;
			background-color: var(--header-bg);
			border-top: 1px solid var(--border-color);
			border-bottom: 1px solid var(--border-color);
			position: sticky;
			top: 40px;
			z-index: 99;
		}

		.table-header-cell {
			padding: 12px 15px;
			font-weight: normal;
			cursor: pointer;
			text-align: left;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			background-color: var(--header-bg);
		}

		.table-header-cell:nth-child(3),
		.table-header-cell:nth-child(4) {
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.table-header-cell:hover {
			background-color: #444;
		}

		/* === –¢–∞–±–ª–∏—Ü–∞ === */
		.table-container {
			overflow-x: auto;
		}
		
		table {
			width: 100%;
			border-collapse: collapse;
			background-color: var(--bg-color);
			border-top: 1px solid var(--border-color);
			margin-top: 0;
			table-layout: fixed;
		}

		td {
			padding: 12px 15px;
			border-bottom: 1px solid var(--border-color);
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
		}

		td:nth-child(1) { width: calc(50% - 60px); }
		td:nth-child(2) { width: calc(50% - 60px); }
		td:nth-child(3) { width: 120px; }
		td:nth-child(4) {
			width: 120px; /* –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä —Å–¥–µ–ª–∞—Ç—å —Å—Ç–æ–ª–±–µ—Ü –∫–∞–∫ –º–æ–∂–Ω–æ —É–∂–µ */
			white-space: nowrap;
			overflow: visible;
		}

		tr:nth-child(even) {
			background-color: var(--row-alt-bg);
		}

		.flags-container {
			display: flex;
			gap: 5px;
			align-items: center;
			justify-content: center;
		}

		.flag-icon {
			width: 20px;
			height: 20px;
			object-fit: contain;
		}

		.request-button {
			background-color: var(--button-bg);
			color: var(--text-color);
			border: none;
			padding: 6px 12px;
			border-radius: 4px;
			cursor: pointer;
			transition: background-color 0.2s;
			text-align: center;
			white-space: nowrap;
		}

		.request-button:hover {
			background-color: var(--button-hover);
		}

		.hidden {
			display: none;
		}

		.pagination {
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 15px;
			padding: 15px;
			background-color: var(--pagination-bg);
			border-top: 1px solid var(--border-color);
			border-bottom: 1px solid var(--border-color);
			position: sticky;
			bottom: 0;
			z-index: 99;
			margin-top: 10px;
			flex-wrap: nowrap;			
		}

		.pagination-top {
			display: grid;
			grid-template-columns: 1fr auto 1fr;
			align-items: center;
			gap: 15px;
			flex: 1;
			justify-content: center;
			min-width: 0;
		}

		.items-per-page {
			display: flex;
			align-items: center;
			gap: 5px;
			white-space: nowrap;
			justify-self: start;
		}

		.items-per-page label {
			font-size: 14px;
			white-space: nowrap;
		}

		.items-per-page select {
			background-color: var(--button-bg);
			color: var(--text-color);
			border: 1px solid var(--border-color);
			padding: 4px 8px;
			border-radius: 4px;
			cursor: pointer;
		}

		.page-info {
			font-size: 14px;
			white-space: nowrap;
			text-align: center;
			justify-self: center;
			margin-left: 40px;
		}

		.page-controls {
			display: flex;
			align-items: center;
			gap: 10px;
			white-space: nowrap;
			justify-self: end;
		}

		.page-btn {
			background-color: var(--button-bg);
			color: var(--text-color);
			border: none;
			padding: 6px 10px 6px;
			border-radius: 4px;
			cursor: pointer;
			transition: background-color 0.2s;
			font-size: 16px;
		}

		.page-btn:hover {
			background-color: var(--button-hover);
		}

		.page-btn:disabled {
			opacity: 0.5;
			cursor: not-allowed;
		}

		/* === –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ === */
		.modal {
			display: none;
			position: fixed;
			z-index: 500;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			overflow: auto;
			background-color: rgba(0,0,0,0.6);
		}

		.modal-content {
			background-color: var(--header-bg);
			position: absolute;
			left: 50%;
			top: 50%;
			transform: translate(-50%, -40%);
			padding: 20px 40px;
			border-radius: 12px;
			width: 90%;
			max-width: 400px;
			color: #fff;
			text-align: left;
			font-size: 14px;
			box-shadow: 0 0 15px rgba(0,0,0,0.4);
		}
		
		.modal-text {
			margin-top: 0;
			margin-bottom: 12px;
			line-height: 1.4;
		}
		
		.donate-links {
			margin: 0;
		}
		
		.donate-link {
			display: block;
			color: #B3DBF2;
			text-decoration: underline;
			margin-top: 12px;
			line-height: 1.4;
			overflow-wrap: break-word;
			word-break: break-all;
			max-width: 100%;
		}
		
		.donate-link:hover {
			color: #fff;
		}

		.modal-buttons {
			display: flex;
			gap: 10px;
			margin-top: 16px;
			justify-content: center;
		}

		.modal-btn {
			margin-top: 15px;
			background: var(--button-bg);
			border: none;
			color: #fff;
			padding: 10px 16px;
			border-radius: 6px;
			cursor: pointer;
			transition: background 0.2s;
		}
		.modal-btn:hover {
			background: var(--button-hover);
		}

		/* –¢–µ–∫—Å—Ç —Å –∫–∞—Ä—Ç–æ–π */
		.modal-donation {
			margin-top: 12px;
			font-size: 14px;
			line-height: 1.4;			
			overflow-wrap: anywhere;
		}

		/* === Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ === */
		.toast {
			white-space: nowrap;
			position: fixed;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background: rgba(30,30,30,0.95);
			color: #fff;
			padding: 8px 18px;
			border-radius: 8px;
			font-size: 14px;
			opacity: 0;
			pointer-events: none;
			transition: opacity 0.3s ease;
			z-index: 1000;
		}

		.toast.show {
			opacity: 1;
		}
		
		#cancelButton,
		#copyButton {
			padding: 10px 16px;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			transition: all 0.2s ease;
			font-size: 12px;
			min-width: 100px;
			box-sizing: border-box;
			text-align: center;
			white-space: nowrap;
			color: #fff;
			background: linear-gradient(135deg, var(--button-bg) 0%, var(--button-hover) 100%);
			box-shadow: 0 2px 5px rgba(0,0,0,0.2);
		}

		#cancelButton:hover,
		#copyButton:hover {
			background: linear-gradient(135deg, var(--button-hover) 0%, var(--button-bg) 100%);
			box-shadow: 0 2px 8px rgba(0,0,0,0.3);
			transform: translateY(-1px);
		}

		#cancelButton {
			background: linear-gradient(135deg, #555 0%, #777 100%);
		}

		#cancelButton:hover {
			background: linear-gradient(135deg, #777 0%, #555 100%);
		}
		
		.card-field {
			position: relative;
			display: inline-flex;
			align-items: center;
			gap: 6px;
			font-size: 14px;
			color: var(--text-color, #B3DBF2);
			cursor: pointer;
			user-select: none;
			text-decoration: none;
			transition: opacity 0.15s ease;
		}

		.card-field::after {
			content: "üìã";
			font-size: 13px;
			opacity: 0.5;
			transition: opacity 0.15s ease;
		}

		.card-field:hover {
			opacity: 0.85;
		}

		.card-field:hover::after {
			opacity: 0.8;
		}

		.card-field:focus {
			outline: none;
			text-decoration: underline;   /* –∞–∫—Ü–µ–Ω—Ç –¥–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–æ–≥–æ —Ñ–æ–∫—É—Å–∞ */
		}

		/* === –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è === */
		@media (max-width: 767px) {
			body {
				padding: 10px;
			}
			
			.container {
				width: 100%;
			}

			.header {
				flex-direction: column;
				align-items: stretch;
				gap: 15px;
				padding: 15px;
			}

			.search-container {
				width: 100%;
				order: 1;
			}

			.icon-buttons {
				order: 2;
				display: flex;
				flex-wrap: nowrap;
				overflow-x: auto;
				-webkit-overflow-scrolling: touch;
				scrollbar-width: none;
				justify-content: center;
				padding-bottom: 5px;
				width: 100%;
				gap: 3px;
			}

			.icon-buttons::-webkit-scrollbar {
				display: none;
			}
			
			.icon-button {
				flex: 0 1 auto;
				min-width: 30px;
			}			
		
			td:nth-child(1) { width: 40%; }
			td:nth-child(2) { width: 40%; }
			td:nth-child(3) { 
				width: 0;
				display: none;
				padding: 0;
				border: none;
			}
			td:nth-child(4) { 
				width: 20%;
				min-width: 80px;
			}
			
			.table-header-cell,
			td {
				padding: 10px 6px;
				font-size: 14px;
			}
			
			.table-header-row {
				grid-template-columns: 40% 40% 0 20%;
			}
			
			.request-button {
				padding: 6px 8px; /* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –∫–Ω–æ–ø–∫–∏ */
				font-size: 12px; /* –£–º–µ–Ω—å—à–∞–µ–º —à—Ä–∏—Ñ—Ç */
				width: 100%; /* –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É —è—á–µ–π–∫–∏ */
				box-sizing: border-box;
			}

			.table-container {
				margin: 0 -10px;
				padding: 0 10px;
			}

			td {
				padding: 10px 8px;
				font-size: 14px;
				white-space: normal;
				word-break: break-word;
			}

			.flags-container,
			.flag-icon {
				display: none !important;
			}

			.request-button {
				padding: 8px 12px;
				font-size: 13px;
			}

			.pagination {
				flex-direction: column;
				align-items: stretch;
				gap: 10px;
				padding: 15px 10px;
				
			}

			.pagination-top {
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 15px;
				flex-wrap: wrap;
			}

			.items-per-page {
				display: flex;
				align-items: center;
				gap: 5px;
				margin: 0;
			}
			
			.page-info {
				margin: 0;
				text-align: center;
			}

			.items-per-page label,
			.page-info {
				font-size: 14px;
			}

			.items-per-page select {
				font-size: 14px;
				padding: 2px 8px;
			}

			.page-controls {
				display: flex;
				gap: 10px;
				justify-content: center;
				width: 100%;
				flex-wrap: wrap;
			}

			.page-btn {
				padding: 8px 12px;
				font-size: 14px;
				flex: 1;
				min-width: 40px;
			}

			.modal {
				padding-bottom: 20px;
			}
			
			.modal-content {
				margin: 0;
				padding: 20px;
				width: 95%;
				transform: translate(-50%, -45%);
				box-sizing: border-box;
			}

			.modal-buttons {
				flex-direction: column;
			}			
		}

		@media (max-width: 480px) {
			
			td:nth-child(1) { width: 40%; }
			td:nth-child(2) { width: 40%; }
			td:nth-child(3) { 
				width: 0;
				display: none;
				padding: 0;
				border: none;
			}
			td:nth-child(4) { 
				width: 20%;
				min-width: 70px;
			}

			.table-header-cell {
				padding: 6px 4px;
				font-size: 12px;
			}

			td {
				padding: 6px 4px;
				font-size: 12px;
			}

			.request-button {
				padding: 4px 6px;
				font-size: 11px;
			}

			.page-btn {
				padding: 6px 8px;
				font-size: 12px;
			}
		}
	</style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="search-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchInput" class="search-input" placeholder="Search">
                <button class="search-clear" id="clearSearch">√ó</button>
            </div>
            <div class="icon-buttons">
                <div class="icon-button" data-filter="earth"><img src="icons/earth.webp" alt="Other" title="–ù–∞ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö"></div>
                <div class="icon-button" data-filter="film"><img src="icons/film.webp" alt="Film" title="–ò–∑ –∫–∏–Ω–æ—Ñ–∏–ª—å–º–æ–≤"></div>
                <div class="icon-button" data-filter="mult"><img src="icons/mult.webp" alt="Animation" title="–ò–∑ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–æ–≤"></div>
                <div class="icon-button" data-filter="piano"><img src="icons/piano.webp" alt="Lyrics" title="–õ–∏—Ä–∏—á–µ—Å–∫–∏–µ"></div>
                <div class="icon-button" data-filter="dance"><img src="icons/dance.webp" alt="Dance" title="–ü–æ—Ç–∞–Ω—Ü–µ–≤–∞—Ç—å"></div>
                <div class="icon-button" data-filter="rock"><img src="icons/rock.webp" alt="Rock" title="–†–û–ö"></div>
                <div class="icon-button" data-filter="pop"><img src="icons/pop.webp" alt="Pop" title="–ü–û–ü"></div>
                <div class="icon-button" data-filter="folk"><img src="icons/folk.webp" alt="Folk" title="–ù–∞—Ä–æ–¥–Ω—ã–µ"></div>
                <div class="icon-button" data-filter="retro"><img src="icons/retro.webp" alt="Retro" title="–†–µ—Ç—Ä–æ"></div>
            </div>
        </div>

        <div class="table-header-row">
            <div class="table-header-cell" id="sortTitle">Title</div>
            <div class="table-header-cell" id="sortArtist">Artist</div>
            <div class="table-header-cell"></div>
            <div class="table-header-cell"></div>
        </div>

        <div class="table-container">
            <table id="musicTable">
                <tbody id="tableBody"></tbody>
            </table>
        </div>

		<div class="pagination">
			<div class="pagination-top">
				<div class="items-per-page">
					<label for="itemsPerPage">Items per page:</label>
					<select id="itemsPerPage">
						<option value="10">10</option>
						<option value="25">25</option>
						<option value="50">50</option>
						<option value="100">100</option>
						<option value="-1">All</option>
					</select>
				</div>
				<div class="page-info" id="pageInfo">1 ‚Äì 10 of 0</div>
			</div>
			<div class="page-controls">
				<button class="page-btn" id="firstPage">I<</button>
				<button class="page-btn" id="prevPage"><</button>
				<button class="page-btn" id="nextPage">></button>
				<button class="page-btn" id="lastPage">>I</button>
			</div>
		</div>
    </div>

	<div id="requestModal" class="modal">
		<div class="modal-content">
			<p class="modal-text">‚ù§Ô∏è –ó–∞–∫–∞–∑–∞—Ç—å –ø–µ—Å–Ω—é "<span id="modalArtistTitle">Artist ‚Äì Title</span>" –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç 200 —Ä—É–±–ª–µ–π</p>
			<p class="modal-text">‚ù§Ô∏è –°–∏–≥–Ω–∞ –≤ –ø–æ–¥–∞—Ä–æ–∫ –æ—Ç 500 —Ä—É–±–ª–µ–π</p>
			<div class="donate-links">
				<a href="https://www.donationalerts.com/r/vanilla_bun_" target="_blank" class="donate-link">https://www.donationalerts.com/r/vanilla_bun_</a>
				<a href="https://new.donatepay.ru/@vanillabun" target="_blank" class="donate-link">https://new.donatepay.ru/@vanillabun</a>
			</div>
			<div class="modal-donation">
				‚ù§Ô∏è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É –¢-–ë–∞–Ω–∫:<br>
				<span id="cardNumber" class="card-field">(–∑–∞–≥—Ä—É–∑–∫–∞...)</span>
			</div>
			<div class="modal-buttons">
				<button id="copyButton">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏</button>
				<button id="cancelButton">Cancel</button>
			</div>
		</div>
	</div>
	<div id="toast" class="toast">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ</div>

	<script>
		// === –ú–∞–ø–ø–∏–Ω–≥–∏ ===
		const attrToIcon = {
			"–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ": "uk.webp",
			"–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–µ": "fr.webp",
			"–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–µ": "it.webp",
			"–ú–æ–ª–¥–∞–≤—Å–∫–∏–µ": "md.webp",
			"–£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ": "ua.webp",
			"–ò–∑ –∫–∏–Ω–æ—Ñ–∏–ª—å–º–æ–≤": "film.webp",
			"–ò–∑ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–æ–≤": "mult.webp",
			"–õ–∏—Ä–∏—á–µ—Å–∫–∏–µ": "piano.webp",
			"–ü–æ—Ç–∞–Ω—Ü–µ–≤–∞—Ç—å": "dance.webp",
			"–†–û–ö": "rock.webp",
			"–ü–û–ü": "pop.webp",
			"–ù–∞—Ä–æ–¥–Ω—ã–µ": "folk.webp",
			"–†–µ—Ç—Ä–æ": "retro.webp"
		};

		const hiddenInTable = new Set([
			"–ù–∞ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö",
			"–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ",
			"A cappella",
			"–ö–æ–ª—ã–±–µ–ª—å–Ω—ã–µ"
		]);

		const attrPriority = [
			"–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ", "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–µ", "–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–µ", "–ú–æ–ª–¥–∞–≤—Å–∫–∏–µ", "–£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ",
			"–ò–∑ –∫–∏–Ω–æ—Ñ–∏–ª—å–º–æ–≤",
			"–ò–∑ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–æ–≤",
			"–õ–∏—Ä–∏—á–µ—Å–∫–∏–µ",
			"–ü–æ—Ç–∞–Ω—Ü–µ–≤–∞—Ç—å",
			"–†–û–ö",
			"–ü–û–ü",
			"–ù–∞—Ä–æ–¥–Ω—ã–µ",
			"–†–µ—Ç—Ä–æ"
		];

		const filterMap = {
			'earth': ["–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ", "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∏–µ", "–ò—Ç–∞–ª—å—è–Ω—Å–∫–∏–µ", "–ú–æ–ª–¥–∞–≤—Å–∫–∏–µ", "–£–∫—Ä–∞–∏–Ω—Å–∫–∏–µ"],
			'film': ["–ò–∑ –∫–∏–Ω–æ—Ñ–∏–ª—å–º–æ–≤"],
			'mult': ["–ò–∑ –º—É–ª—å—Ç—Ñ–∏–ª—å–º–æ–≤"],
			'piano': ["–õ–∏—Ä–∏—á–µ—Å–∫–∏–µ"],
			'dance': ["–ü–æ—Ç–∞–Ω—Ü–µ–≤–∞—Ç—å"],
			'rock': ["–†–û–ö"],
			'pop': ["–ü–û–ü"],
			'folk': ["–ù–∞—Ä–æ–¥–Ω—ã–µ"],
			'retro': ["–†–µ—Ç—Ä–æ"]
		};

		const fallbackIcon = "unknown.webp";

		// === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
		let allSongs = [];
		let filteredSongs = [];
		let currentPage = 1;
		let sortColumn = null;
		let sortDirection = 'asc';
		let activeFilters = [];
		let itemsPerPageRaw = parseInt(localStorage.getItem('itemsPerPageRaw')) || 10;

		// === –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ===
		const modal = document.getElementById('requestModal');
		const modalText = document.getElementById('modalArtistTitle');
		const cancelButton = document.getElementById('cancelButton');
		const copyButton = document.getElementById('copyButton');
		const toast = document.getElementById('toast');

		function openModal(title, artist) {
			modalText.textContent = `${artist ? artist + " ‚Äì " : ""}${title}`;
			modal.style.display = "block";
		}

		function closeModal() {
			modal.style.display = "none";
		}

		cancelButton.addEventListener('click', closeModal);

		copyButton.addEventListener('click', () => {
			const text = modalText.textContent;
			navigator.clipboard.writeText(text).then(() => {
				showToast("–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ");
			});
		});

		function showToast(msg) {
			toast.textContent = msg;
			toast.classList.add('show');
			setTimeout(() => toast.classList.remove('show'), 2000);
		}

		window.addEventListener('click', (e) => {
			if (e.target === modal) closeModal();
		});
		
		const cardNumberEl = document.getElementById('cardNumber');

		const encodedCard = "MjIwMCA3MDIwIDQ5MDcgNzQ0NA==";
		const cardNumber = atob(encodedCard);

		cardNumberEl.textContent = `${cardNumber} (–ê–Ω–∞—Å—Ç–∞—Å–∏—è –ì.)`;

		cardNumberEl.setAttribute('role', 'button');
		cardNumberEl.setAttribute('tabindex', '0');
		cardNumberEl.setAttribute('aria-label', '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã. –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å');
		cardNumberEl.title = '–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã';

		cardNumberEl.addEventListener('click', () => {
			navigator.clipboard.writeText(cardNumber).then(() => {
				showToast("–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω");
				cardNumberEl.blur();
			}).catch(() => {
				showToast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ‚Äî –≤—ã–¥–µ–ª–∏—Ç–µ –≤—Ä—É—á–Ω—É—é");
			});
		});

		cardNumberEl.addEventListener('keydown', (e) => {
			if (e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar') {
				e.preventDefault();
				cardNumberEl.click();
			}
		});

		function getEffectiveItemsPerPage() {
			return (itemsPerPageRaw <= 0) ? (filteredSongs.length || 1) : itemsPerPageRaw;
		}

		// === –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã ===
		function renderTable() {
			const tbody = document.getElementById('tableBody');
			tbody.innerHTML = '';

			const effectiveItemsPerPage = getEffectiveItemsPerPage();
			
			const totalPages = Math.max(1, Math.ceil(filteredSongs.length / effectiveItemsPerPage));
			
			if (currentPage < 1) currentPage = 1;
			if (currentPage > totalPages) currentPage = totalPages;
			
			const startIndex = (currentPage - 1) * effectiveItemsPerPage;
			const endIndex = Math.min(startIndex + effectiveItemsPerPage, filteredSongs.length);

			for (let i = startIndex; i < endIndex; i++) {
				const row = filteredSongs[i];
				const title = row.title || '';
				const artist = row.artist || '';
				const attrs = row.attributes ? row.attributes.split(',').map(s => s.trim()) : [];

				const visibleAttrs = attrs.filter(attr => !hiddenInTable.has(attr));
				visibleAttrs.sort((a, b) => {
					const ia = attrPriority.indexOf(a);
					const ib = attrPriority.indexOf(b);
					if (ia === -1 && ib === -1) return 0;
					if (ia === -1) return 1;
					if (ib === -1) return -1;
					return ia - ib;
				});

				let flagsHtml = '';
				if (visibleAttrs.length > 0) {
					flagsHtml = '<div class="flags-container">';
					visibleAttrs.forEach(attr => {
						const iconName = attrToIcon[attr] || fallbackIcon;
						flagsHtml += `<img class="flag-icon" src="icons/${iconName}" alt="${attr}">`;
					});
					flagsHtml += '</div>';
				}

				const tr = document.createElement('tr');
				const requestBtn = document.createElement('button');
				requestBtn.className = 'request-button';
				requestBtn.textContent = 'Request';
				requestBtn.addEventListener('click', () => openModal(title, artist));

				tr.innerHTML = `
					<td>${title}</td>
					<td>${artist}</td>
					<td>${flagsHtml}</td>
					<td></td>
				`;
				tr.querySelector('td:last-child').appendChild(requestBtn);
				tbody.appendChild(tr);
			}

			const pageInfo = document.getElementById('pageInfo');
			if (filteredSongs.length === 0) {
				pageInfo.textContent = `0 ‚Äì 0 of 0`;
			} else {
				pageInfo.textContent = `${startIndex + 1} ‚Äì ${endIndex} of ${filteredSongs.length}`;
			}

			document.getElementById('firstPage').disabled = currentPage === 1;
			document.getElementById('prevPage').disabled = currentPage === 1;
			document.getElementById('nextPage').disabled = currentPage >= totalPages;
			document.getElementById('lastPage').disabled = currentPage >= totalPages;
		}
		
		//–ø–æ–∏—Å–∫
		function fixKeyboardLayout(str) {
			if (!str) return '';
			const map = {
				'q':'–π','w':'—Ü','e':'—É','r':'–∫','t':'–µ','y':'–Ω','u':'–≥','i':'—à','o':'—â','p':'–∑','[':'—Ö',']':'—ä',
				'a':'—Ñ','s':'—ã','d':'–≤','f':'–∞','g':'–ø','h':'—Ä','j':'–æ','k':'–ª','l':'–¥',';':'–∂',"'":'—ç',
				'z':'—è','x':'—á','c':'—Å','v':'–º','b':'–∏','n':'—Ç','m':'—å',',':'–±','.':'—é','`':'—ë',
				'–π':'q','—Ü':'w','—É':'e','–∫':'r','–µ':'t','–Ω':'y','–≥':'u','—à':'i','—â':'o','–∑':'p','—Ö':'[','—ä':']',
				'—Ñ':'a','—ã':'s','–≤':'d','–∞':'f','–ø':'g','—Ä':'h','–æ':'j','–ª':'k','–¥':'l','–∂':';','—ç':"'",
				'—è':'z','—á':'x','—Å':'c','–º':'v','–∏':'b','—Ç':'n','—å':'m','–±':',','—é':'.','—ë':'`'
			};
			return str.split('').map(ch => map[ch] || ch).join('');
		}

		function normalizeForSearch(s) {
			if (!s) return '';
			return s
				.normalize("NFD")
				.replace(/–º–∞–∫s–∏–º/gi, match => '–º–∞–∫—Å–∏–º')
				.replace(/m[√•a]neskin/gi, 'maneskin')
				.replace(/[\u0300-\u036f]/g, '')
				.replace(/—ë/g, '–µ')
				.replace(/\$/g, 's')		
				.replace(/[^a-z–∞-—è0-9\s]/gi, ' ')
				.toLowerCase()
				.replace(/\s+/g, ' ')
				.trim();
		}

		function getSearchVariants(input) {
			if (!input) return [];
			const fixed = fixKeyboardLayout(input);
			const variants = [input, fixed]
				.map(v => normalizeForSearch(v))
				.filter((v, i, arr) => v && arr.indexOf(v) === i);
			return variants;
		}

		function filterSongs() {
			const raw = document.getElementById('searchInput').value || '';
			const variants = getSearchVariants(raw);

			filteredSongs = allSongs.filter(row => {
				const title = normalizeForSearch(row.title);
				const artist = normalizeForSearch(row.artist);
				const attributes = normalizeForSearch(row.attributes);

				const combined = `${artist} ${title}`;
				const combinedReverse = `${title} ${artist}`;

				const matchesSearch = variants.length === 0 || variants.some(v => {
					const words = v.split(' ');
					return words.every(w =>
						title.includes(w) ||
						artist.includes(w) ||
						attributes.includes(w) ||
						combined.includes(w) ||
						combinedReverse.includes(w)
					);
				});

				const matchesFilter =
					activeFilters.length === 0 ||
					activeFilters.some(f => {
						const requiredAttrs = filterMap[f] || [];
						return requiredAttrs.some(req =>
							attributes.includes(normalizeForSearch(req))
						);
					});

				return matchesSearch && matchesFilter;
			});

			currentPage = 1;
			renderTable();
		}
		
		//—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
		function sortTable(column) {
			if (sortColumn === column) {
				sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
			} else {
				sortColumn = column;
				sortDirection = 'asc';
			}

			filteredSongs.sort((a, b) => {
				const valA = a[column].toLowerCase();
				const valB = b[column].toLowerCase();
				return sortDirection === 'asc'
					? valA.localeCompare(valB)
					: valB.localeCompare(valA);
			});

			renderTable();
		}

		async function checkAndLoadCSV() {
			const commitUrl = "https://api.github.com/repos/Vanilla-Bun/songlist/commits?path=song-export.csv&per_page=1";
			const csvUrl = "https://raw.githubusercontent.com/Vanilla-Bun/songlist/main/song-export.csv";

			const storedSha = localStorage.getItem("songlist_sha");
			const storedData = localStorage.getItem("songlist_data");

			try {
				const commitResponse = await fetch(commitUrl);
				if (!commitResponse.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫–æ–º–º–∏—Ç–∞");
				const commitData = await commitResponse.json();
				const latestSha = commitData[0]?.sha;

				if (storedSha === latestSha && storedData) {
					console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –∏–∑ localStorage");
					loadCSVData(storedData);
					return;
				}

				console.log("üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...");
				const csvResponse = await fetch(csvUrl);
				if (!csvResponse.ok) throw new Error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV");
				const csvText = await csvResponse.text();

				// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
				localStorage.setItem("songlist_sha", latestSha);
				localStorage.setItem("songlist_data", csvText);

				loadCSVData(csvText);
			} catch (error) {
				console.error("‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:", error);

				if (storedData) {
					console.log("üì¶ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ—à–∏–±–∫–∞ —Å–µ—Ç–∏)");
					loadCSVData(storedData);
				}
			}
		}

		function loadCSVData(csvText) {
			Papa.parse(csvText, {
				header: true,
				skipEmptyLines: true,
				complete: function(results) {
					allSongs = results.data.filter(row => row.active === 'true');
					filteredSongs = allSongs;
					currentPage = 1;
					renderTable();
				}
			});
		}

		// === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===		
		document.addEventListener('DOMContentLoaded', () => {			
			let searchTimeout;
				const searchInput = document.getElementById('searchInput');
				searchInput.addEventListener('input', () => {
					clearTimeout(searchTimeout);
					searchTimeout = setTimeout(filterSongs, 250); // 250 –º—Å –∑–∞–¥–µ—Ä–∂–∫–∏
				});
			document.getElementById('clearSearch').addEventListener('click', () => {
				document.getElementById('searchInput').value = '';
				filterSongs();
			});		
	
			const savedItemsRaw = localStorage.getItem('itemsPerPageRaw');
			if (savedItemsRaw !== null) {
				itemsPerPageRaw = parseInt(savedItemsRaw, 10);
				const sel = document.getElementById('itemsPerPage');
				if (sel) sel.value = String(itemsPerPageRaw);
			}
			document.getElementById('itemsPerPage').addEventListener('change', (e) => {
				const raw = parseInt(e.target.value, 10);
				itemsPerPageRaw = isNaN(raw) ? 10 : raw;
				localStorage.setItem('itemsPerPageRaw', String(itemsPerPageRaw));
				currentPage = 1;
				renderTable();
			});
		
			document.getElementById('firstPage').addEventListener('click', () => {
				currentPage = 1;
				renderTable();
			});

			document.getElementById('prevPage').addEventListener('click', () => {
				if (currentPage > 1) {
					currentPage--;
					renderTable();
				}
			});

			document.getElementById('nextPage').addEventListener('click', () => {
				const effectiveItemsPerPage = getEffectiveItemsPerPage();
				const totalPages = Math.max(1, Math.ceil(filteredSongs.length / effectiveItemsPerPage));
				if (currentPage < totalPages) {
					currentPage++;
					renderTable();
				}
			});

			document.getElementById('lastPage').addEventListener('click', () => {
				const effectiveItemsPerPage = getEffectiveItemsPerPage();
				currentPage = Math.max(1, Math.ceil(filteredSongs.length / effectiveItemsPerPage));
				renderTable();
			});

			document.getElementById('sortTitle').addEventListener('click', () => sortTable('title'));
			document.getElementById('sortArtist').addEventListener('click', () => sortTable('artist'));
			
			const iconButtons = document.querySelectorAll('.icon-button[data-filter]');
			iconButtons.forEach(btn => {
				const key = btn.dataset.filter;
				btn.addEventListener('click', () => {
					const index = activeFilters.indexOf(key);
					if (index === -1) {
						activeFilters.push(key);
						btn.style.backgroundColor = '#2D2D2D'; // –∞–∫—Ç–∏–≤–Ω—ã–π —Ü–≤–µ—Ç
					} else {
						activeFilters.splice(index, 1);
						btn.style.backgroundColor = ''; // —Å–±—Ä–æ—Å
					}
					filterSongs();
				});
			});

		checkAndLoadCSV();
		});
	</script>
</body>
</html>
